<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Лична Призма – Блог</title>
  <meta name="description" content="Личен блог – публикации, теми, архив и автор." />
  <style>
    /* ==========================
       БАЗОВ СТИЛ + ТЕМА
       Всичко е в един файл за лесно тестване
       ========================== */
    :root{
      --bg: #ffffff;
      --surface: #f7f7f8;
      --ink: #1c1d20;
      --ink-muted:#5a5d66;
      --brand: #2b6cb0; /* синьо */
      --brand-ink: #174777;
      --accent: #e2e8f0; /* светло сиво */
      --border: #e5e7eb;
      --shadow: 0 10px 25px rgba(0,0,0,.06);
      --radius: 16px;
      --radius-sm: 12px;
      --radius-lg: 22px;
    }

    /* Тъмен режим (по избор на системата) */
    @media (prefers-color-scheme: dark){
      :root{
        --bg: #0b0c0f;
        --surface: #121319;
        --ink: #f5f7fb;
        --ink-muted: #b1b5c3;
        --brand: #8ab4ff;
        --brand-ink:#2b6cb0;
        --accent: #1c1f2b;
        --border: #212432;
        --shadow: 0 8px 24px rgba(0,0,0,.35);
      }
      img{filter: brightness(.98) contrast(1.02)}
    }

    *{box-sizing: border-box}
    html,body{height:100%}
    body{
      margin:0;
      font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial;
      color: var(--ink);
      background: var(--bg);
    }
    a{ color: var(--brand); text-decoration: none; }
    a:hover{ text-decoration: underline; }
    h1,h2,h3,h4{ margin: 0 0 .35em; line-height:1.2 }
    h1{ font-size: clamp(1.6rem, 2vw + 1rem, 2.4rem); }
    h2{ font-size: clamp(1.25rem, 1.2vw + .9rem, 1.5rem); }
    p{ margin: .5em 0 1em; }
    .container{
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 18px;
    }

    /* ==========================
       ХЕДЪР
       ========================== */
    header.site-header{
      position: sticky; top: 0; z-index: 50;
      background: rgba(255,255,255,.8);
      backdrop-filter: saturate(140%) blur(10px);
      border-bottom: 1px solid var(--border);
    }
    @media (prefers-color-scheme: dark){
      header.site-header{ background: rgba(15,16,22,.7) }
    }
    .site-header .bar{
      display:flex; align-items:center; gap: 16px;
      padding: 14px 0;
    }
    .brand{ display:flex; align-items:center; gap:12px; }
    .brand-logo{ width:40px; height:40px; border-radius: 12px; background: linear-gradient(135deg, var(--brand), #7c3aed); box-shadow: var(--shadow); }
    .brand h1{ letter-spacing:.4px; }

    nav.primary-nav{ margin-left:auto; }
    nav.primary-nav ul{ list-style:none; margin:0; padding:0; display:flex; gap:14px; flex-wrap:wrap}
    nav.primary-nav a{ display:inline-block; padding:8px 12px; border-radius: 10px; }
    nav.primary-nav a:hover{ background: var(--accent); text-decoration:none }

    /* ==========================
       ЛАУТ – Лява колона + съдържание
       ========================== */
    .layout{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 22px;
      align-items: start;
      padding: 18px 0 36px;
    }
    @media (max-width: 960px){
      .layout{ grid-template-columns: 1fr; }
      aside.sidebar{ order: 2; }
    }

    aside.sidebar{
      position: sticky; top: 76px; /* под хедъра */
      max-height: calc(100dvh - 90px);
      overflow: auto;
      padding-right: 4px;
    }

    .card{ background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); }
    .card + .card{ margin-top: 16px; }
    .card .card-h{ padding: 14px 16px; border-bottom: 1px solid var(--border); font-weight: 600; color: var(--brand-ink); }
    .card .card-c{ padding: 12px 16px; }

    .mini-post{
      display:grid; grid-template-columns: 72px 1fr; gap:10px; align-items:center; padding:8px 0; border-bottom:1px dashed var(--border);
    }
    .mini-post:last-child{ border-bottom:0 }
    .mini-post img{ width:72px; height:72px; object-fit:cover; border-radius: 10px; }
    .mini-title{ font-weight:600; }
    .meta{ color: var(--ink-muted); font-size:.9rem }

    .tag-cloud{ display:flex; flex-wrap:wrap; gap:8px }
    .tag{ padding:6px 10px; background:var(--accent); border-radius: 999px; font-size:.92rem; display:inline-flex; align-items:center; gap:6px }
    .tag .count{ font-size:.85em; color: var(--ink-muted) }

    .archive-list{ list-style:none; margin:0; padding:0; display:grid; gap:8px }
    .archive-list a{ display:flex; justify-content:space-between; align-items:center; padding:8px 10px; border-radius:10px }
    .archive-list a:hover{ background:var(--accent); text-decoration:none }

    .author{
      display:grid; grid-template-columns: 64px 1fr; gap:12px; align-items:center;
    }
    .author img{ width:64px; height:64px; border-radius:14px; object-fit:cover; box-shadow: var(--shadow) }
    .author small{ color: var(--ink-muted) }

    /* ==========================
       ОСНОВНА СЕКЦИЯ
       ========================== */
    main#app{ display:grid; gap: 16px; }

    .post-card{
      background: var(--surface); border:1px solid var(--border); border-radius: var(--radius);
      overflow:hidden; box-shadow: var(--shadow);
    }
    .post-media{ width:100%; aspect-ratio: 16/9; object-fit: cover; background:#ddd }
    .post-body{ padding: 14px 16px 16px; }
    .post-body h2{ margin-top:.1rem }
    .post-actions{ display:flex; flex-wrap:wrap; gap:12px; align-items:center; padding: 0 16px 16px; }
    .chip{ padding:6px 10px; border:1px solid var(--border); border-radius: 999px; font-size:.92rem; }

    .pagination{ display:flex; justify-content:space-between; align-items:center; margin-top:8px; padding: 12px 0 0; border-top: 1px dashed var(--border); }
    .pagination .pages{ display:flex; gap:6px; flex-wrap:wrap }
    .pagination a{ padding:6px 10px; border-radius: 8px; border:1px solid var(--border); }
    .pagination a[aria-current="page"]{ background: var(--brand); color:white; border-color: transparent; }

    /* Single view */
    article.single{ background: var(--surface); border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); }
    .single .hero{ width:100%; aspect-ratio:16/9; object-fit:cover }
    .single .wrap{ padding: 16px; }
    .single .content img{ max-width:100%; border-radius:12px }
    .single .content figure{ margin: 0; }
    .single .content p{ text-wrap: pretty; }
    .back-link{ display:inline-block; margin-bottom: 8px }

    .comments{ margin-top: 22px; border-top:1px dashed var(--border); padding-top: 12px }
    .comment{ padding:10px 12px; border:1px solid var(--border); border-radius: 12px; background:var(--bg) }
    .comment + .comment{ margin-top: 10px }
    .comment small{ color: var(--ink-muted) }

    .muted{ color: var(--ink-muted) }
    .hidden{ display:none }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container bar">
      <a href="#" class="brand" data-link>
        <div class="brand-logo" aria-hidden="true"></div>
        <h1>Лична Призма</h1>
      </a>
      <nav class="primary-nav" aria-label="Основна навигация">
        <ul>
          <li><a href="#" data-link>Начало</a></li>
          <li><a href="#topics" data-link>Теми</a></li>
          <li><a href="#archive" data-link>Архив</a></li>
          <li><a href="#contact" data-link>Контакт</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="container layout">
    <!-- Лявата вертикална секция -->
    <aside class="sidebar" id="sidebar">
      <!-- Някои публикации -->
      <section class="card" aria-labelledby="side-latest-h">
        <div class="card-h" id="side-latest-h">Публикации</div>
        <div class="card-c" id="side-latest"></div>
      </section>

      <!-- Теми -->
      <section class="card" aria-labelledby="topics-h">
        <div class="card-h" id="topics-h">Теми</div>
        <div class="card-c">
          <div class="tag-cloud" id="tag-cloud"></div>
        </div>
      </section>

      <!-- Архив -->
      <section class="card" aria-labelledby="archive-h">
        <div class="card-h" id="archive-h">Архив</div>
        <div class="card-c">
          <ul class="archive-list" id="archive-list"></ul>
        </div>
      </section>

      <!-- Автор -->
      <section class="card" aria-labelledby="author-h">
        <div class="card-h" id="author-h">За автора</div>
        <div class="card-c">
          <div class="author">
            <img src="https://picsum.photos/200?random=3" alt="Автор – профилна снимка" />
            <div>
              <strong>Автор: Иван Петров</strong><br />
              <small>Пише за лични прозрения, технологии и общество. Тук ще намерите подбрани теми и архив от публикации.</small>
            </div>
          </div>
        </div>
      </section>
    </aside>

    <!-- Основна секция -->
    <main id="app" aria-live="polite" aria-busy="false">
      <!-- Съдържанието се рендва динамично от JS (начален изглед: 5 най-нови) -->
    </main>
  </div>

  <script>
    /**
     * ==============================================
     * ДАННИ (примерни) – заменете със свои реални
     * ==============================================
     */
    const POSTS = [
      {
        id: 1,
        title: "Добре дошли в 'Лична Призма'",
        date: "2025-08-15",
        tags: ["Лични", "Новини"],
        cover: "https://picsum.photos/1280/720?random=11",
        excerpt: "Започвам този блог с идеята да събера на едно място бележки, есета и снимки от ежедневието.",
        html: `<p>Това е първата публикация в блога. Идеята е да събирам наблюдения от ежедневието, кратки размишления за технологии и общество, както и фото бележки. Ако искате да следите новите публикации, добавете страницата в отметките си.</p>
               <p>Блогът е изграден като еднофайловa HTML страница с вграден JavaScript, за лесно тестване и миграция.</p>`
      },
      {
        id: 2,
        title: "Снимки от утринната разходка",
        date: "2025-07-30",
        tags: ["Снимки", "Лични"],
        cover: "https://picsum.photos/1280/720?random=12",
        excerpt: "Спокойствието на ранното утро и играта на светлина.",
        html: `<p>Няколко момента, уловени по време на ранната разходка: светлина, сенки, отражения. Тук са някои от кадрите.</p>
               <figure><img src="https://picsum.photos/1000/600?random=112" alt="Снимка 1"/></figure>
               <figure><img src="https://picsum.photos/1000/600?random=113" alt="Снимка 2"/></figure>`
      },
      {
        id: 3,
        title: "Бележки за четене през август",
        date: "2025-07-18",
        tags: ["Книги"],
        cover: "https://picsum.photos/1280/720?random=13",
        excerpt: "Кратък списък с книги и статии, които ми бяха полезни.",
        html: `<p>Списъкът включва есеистика и научно-популярни заглавия. Записките ми са лични и кратки, но може да са полезни.</p>`
      },
      {
        id: 4,
        title: "Малка градска история",
        date: "2025-06-05",
        tags: ["Есе", "Град"],
        cover: "https://picsum.photos/1280/720?random=14",
        excerpt: "Кратък разказ за неочаквана среща на спирката.",
        html: `<p>В един дъждовен следобед, спирката се превърна в сцена за съвсем човешки разговор...</p>`
      },
      {
        id: 5,
        title: "Техническа бележка: Минимален блог без бекенд",
        date: "2025-05-22",
        tags: ["Технологии", "Web"],
        cover: "https://picsum.photos/1280/720?random=15",
        excerpt: "Как е направена тази страница – SPA навигация, коментари в localStorage и архив по месеци.",
        html: `<p>Този блог е реализиран като SPA (Single Page Application) без външни зависимости. Навигацията използва hash-базиран рутер (<code>#post/ID</code>, <code>#page/N</code>),
              а коментарите се пазят локално в браузъра чрез <code>localStorage</code>.</p>`
      },
      {
        id: 6,
        title: "Снимка на деня",
        date: "2025-05-10",
        tags: ["Снимки"],
        cover: "https://picsum.photos/1280/720?random=16",
        excerpt: "Кадър, който ме усмихна.",
        html: `<p>Понякога една снимка казва повече от хиляди думи. Ето я:</p>
               <figure><img src="https://picsum.photos/1000/600?random=116" alt="Кадър"/></figure>`
      },
      {
        id: 7,
        title: "Уикенд маршрут",
        date: "2025-04-28",
        tags: ["Пътуване"],
        cover: "https://picsum.photos/1280/720?random=17",
        excerpt: "Кратка пътека близо до града.",
        html: `<p>Маршрутът е приятен и лек, подходящ за къс следобед. Носете вода и леко яке.</p>`
      },
      {
        id: 8,
        title: "Записки за вниманието",
        date: "2025-04-10",
        tags: ["Есе"],
        cover: "https://picsum.photos/1280/720?random=18",
        excerpt: "Какво означава да си наистина внимателен в ежедневието.",
        html: `<p>Вниманието е ограничен ресурс. Тук са моите начини да го пазя.</p>`
      },
      {
        id: 9,
        title: "Музикална пауза",
        date: "2025-03-02",
        tags: ["Музика"],
        cover: "https://picsum.photos/1280/720?random=19",
        excerpt: "Албум, към който често се връщам.",
        html: `<p>Няколко любими парчета и защо ги харесвам.</p>`
      },
      {
        id: 10,
        title: "Една идея за снимка",
        date: "2025-02-14",
        tags: ["Снимки", "Идеи"],
        cover: "https://picsum.photos/1280/720?random=20",
        excerpt: "Серия от кадри с повторяем мотив.",
        html: `<p>Идеята е да търсим повторение на форми в градската среда.</p>`
      },
      {
        id: 11,
        title: "Архивни бележки",
        date: "2024-12-01",
        tags: ["Архив"],
        cover: "https://picsum.photos/1280/720?random=21",
        excerpt: "Събрах някои по-стари чернови и снимки.",
        html: `<p>Архивът е полезен за проследяване на идеи във времето.</p>`
      },
      {
        id: 12,
        title: "Още снимки",
        date: "2024-10-05",
        tags: ["Снимки"],
        cover: "https://picsum.photos/1280/720?random=22",
        excerpt: "Есенни цветове и тихи улици.",
        html: `<p>Ето още няколко кадъра от есента.</p>
               <figure><img src="https://picsum.photos/1000/600?random=122" alt="Есен"/></figure>`
      }
    ];

    /** Форматиране на дата (bg) */
    const fmtDate = (iso) => new Date(iso + 'T00:00:00').toLocaleDateString('bg-BG', { day:'2-digit', month:'long', year:'numeric' });

    /** Четимо извадка от HTML */
    function toExcerpt(html, max=180){
      const text = html.replace(/<[^>]+>/g, '').replace(/\s+/g,' ').trim();
      return text.length > max ? text.slice(0, max-1).trim() + '…' : text;
    }

    /** Данни за тагове и архив */
    function computeTaxonomies(posts){
      const tags = new Map();
      const archive = new Map(); // key: YYYY-MM
      for(const p of posts){
        (p.tags||[]).forEach(t=> tags.set(t, (tags.get(t)||0)+1));
        const ym = p.date.slice(0,7);
        archive.set(ym, (archive.get(ym)||0)+1);
      }
      // сортиране по име / по дата
      return {
        tags: [...tags.entries()].sort((a,b)=> a[0].localeCompare(b[0],'bg')),
        archive: [...archive.entries()].sort((a,b)=> b[0].localeCompare(a[0]))
      }
    }

    /** Рендер – лява колона */
    function renderSidebar(posts){
      // Някои публикации (последните 6)
      const side = document.getElementById('side-latest');
      side.innerHTML = posts.slice(0,6).map(p=>`
        <article class="mini-post">
          <a href="#post/${p.id}" data-link>
            <img src="${p.cover||'https://picsum.photos/300?grayscale'}" alt="${escapeHtml(p.title)}" loading="lazy" />
          </a>
          <div>
            <a class="mini-title" href="#post/${p.id}" data-link>${escapeHtml(p.title)}</a>
            <div class="meta">${fmtDate(p.date)}</div>
          </div>
        </article>
      `).join('');

      const { tags, archive } = computeTaxonomies(posts);

      // Теми
      const tcloud = document.getElementById('tag-cloud');
      tcloud.innerHTML = tags.map(([t,c])=>`<a class="tag" href="#tag/${encodeURIComponent(t)}" data-link>${escapeHtml(t)} <span class="count">(${c})</span></a>`).join('');

      // Архив (YYYY-MM → Човешки месец)
      const alist = document.getElementById('archive-list');
      alist.innerHTML = archive.map(([ym,c])=>{
        const [y,m] = ym.split('-');
        const d = new Date(`${ym}-01T00:00:00`);
        const label = d.toLocaleDateString('bg-BG', { month:'long', year:'numeric' });
        return `<li><a href="#archive/${ym}" data-link><span>${label}</span><span class="muted">${c}</span></a></li>`
      }).join('');
    }

    /** Домашен изглед (последни 5, с пагинация) */
    const PAGE_SIZE = 5;
    function renderHome(page=1, list=POSTS){
      const app = document.getElementById('app');
      const start = (page-1)*PAGE_SIZE;
      const slice = list.slice(start, start+PAGE_SIZE);
      app.innerHTML = slice.map(p=>`
        <article class="post-card">
          ${p.cover ? `<img class="post-media" src="${p.cover}" alt="${escapeHtml(p.title)}" loading="lazy" />` : ''}
          <div class="post-body">
            <h2><a href="#post/${p.id}" data-link>${escapeHtml(p.title)}</a></h2>
            <div class="meta">Публикувано: ${fmtDate(p.date)} · Теми: ${(p.tags||[]).map(t=>`<a href="#tag/${encodeURIComponent(t)}" data-link>${escapeHtml(t)}</a>`).join(', ') || '—'}</div>
            <p>${escapeHtml(p.excerpt || toExcerpt(p.html))}</p>
          </div>
          <div class="post-actions">
            ${shareButtons(p)}
            <a class="chip" href="#post/${p.id}" data-link>Коментари</a>
            <a class="chip" href="#post/${p.id}" data-link>Прочети цялата статия</a>
          </div>
        </article>
      `).join('') + renderPagination(page, Math.ceil(list.length/PAGE_SIZE));
      window.scrollTo({top:0, behavior:'smooth'});
    }

    function renderPagination(page, pages){
      if (pages <= 1) return '';
      const prev = page>1 ? `<a href="#page/${page-1}" data-link>← Предишни</a>` : '<span></span>';
      const next = page<pages ? `<a href="#page/${page+1}" data-link>Следващи →</a>` : '<span></span>';
      const nums = Array.from({length: pages}, (_,i)=>{
        const n = i+1;
        return `<a href="#page/${n}" data-link ${n===page? 'aria-current="page"':''}>${n}</a>`;
      }).join('');
      return `<nav class="pagination" aria-label="Навигация между страници">
        ${prev}
        <div class="pages">${nums}</div>
        ${next}
      </nav>`;
    }

    /** Единична статия */
    function renderPost(id){
      const app = document.getElementById('app');
      const p = POSTS.find(x=> String(x.id) === String(id));
      if(!p){ app.innerHTML = `<p>Статията не е намерена.</p>`; return; }
      app.innerHTML = `
        <article class="single">
          ${p.cover ? `<img class="hero" src="${p.cover}" alt="${escapeHtml(p.title)}" />` : ''}
          <div class="wrap">
            <a class="back-link" href="#" data-link>← Към началото</a>
            <h2>${escapeHtml(p.title)}</h2>
            <div class="meta">Публикувано: ${fmtDate(p.date)} · Теми: ${(p.tags||[]).map(t=>`<a href="#tag/${encodeURIComponent(t)}" data-link>${escapeHtml(t)}</a>`).join(', ') || '—'}</div>
            <div class="content">${p.html}</div>
            <div class="post-actions" style="padding-left:0">
              ${shareButtons(p)}
            </div>

            <section class="comments" aria-labelledby="comments-h">
              <h3 id="comments-h">Коментари</h3>
              <div id="comments-list"></div>
              <form id="comment-form" style="margin-top:10px">
                <label for="cname">Име</label><br>
                <input id="cname" name="name" required style="width:100%; padding:10px; border:1px solid var(--border); border-radius:10px"/><br><br>
                <label for="cbody">Коментар</label><br>
                <textarea id="cbody" name="body" required rows="4" style="width:100%; padding:10px; border:1px solid var(--border); border-radius:10px"></textarea><br>
                <button class="chip" type="submit">Публикувай</button>
              </form>
              <div style="margin-top:8px">
                <a class="chip" href="#" data-link>← Към главния изглед</a>
              </div>
            </section>
          </div>
        </article>
      `;
      renderComments(id);
      const form = document.getElementById('comment-form');
      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const name = form.querySelector('#cname').value.trim();
        const body = form.querySelector('#cbody').value.trim();
        if(!name || !body) return;
        const item = { name, body, dt: new Date().toISOString() };
        const key = `comments_${id}`;
        const arr = JSON.parse(localStorage.getItem(key) || '[]');
        arr.push(item);
        localStorage.setItem(key, JSON.stringify(arr));
        form.reset();
        renderComments(id);
      });
      window.scrollTo({top:0, behavior:'smooth'});
    }

    /** Коментари (localStorage; демо) */
    function renderComments(id){
      const wrap = document.getElementById('comments-list');
      const key = `comments_${id}`;
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      if(arr.length===0){ wrap.innerHTML = `<p class="muted">Все още няма коментари. Бъдете първи.</p>`; return; }
      wrap.innerHTML = arr.slice().reverse().map(c=>`
        <div class="comment">
          <strong>${escapeHtml(c.name)}</strong>
          <small> · ${new Date(c.dt).toLocaleString('bg-BG')}</small>
          <p>${escapeHtml(c.body).replace(/\n/g,'<br>')}</p>
        </div>
      `).join('');
    }

    /** Споделяне */
    function shareButtons(p){
      const url = location.origin + location.pathname + `#post/${p.id}`;
      const title = encodeURIComponent(p.title);
      const u = encodeURIComponent(url);
      const fb = `https://www.facebook.com/sharer/sharer.php?u=${u}`;
      const x = `https://twitter.com/intent/tweet?url=${u}&text=${title}`;
      const mail = `mailto:?subject=${title}&body=${u}`;
      return `
        <button class="chip" onclick="shareNative('${escapeQuotes(p.title)}','${escapeQuotes(url)}')">Сподели</button>
        <a class="chip" href="${fb}" target="_blank" rel="noopener">Facebook</a>
        <a class="chip" href="${x}" target="_blank" rel="noopener">X/Twitter</a>
        <a class="chip" href="${mail}">Имейл</a>`;
    }

    async function shareNative(title, url){
      try{
        if(navigator.share){ await navigator.share({ title, url }); }
        else{ alert('Използвайте бутоните за социални мрежи.'); }
      }catch(e){ /* отказано */ }
    }

    /** Филтър по таг */
    function renderByTag(tag){
      const list = POSTS.filter(p=> (p.tags||[]).includes(tag));
      const app = document.getElementById('app');
      if(list.length===0){ app.innerHTML = `<p>Няма публикации с тема „${escapeHtml(tag)}“.</p>`; return; }
      app.innerHTML = `<h2>Тема: ${escapeHtml(tag)}</h2>`;
      renderHome(1, list);
    }

    /** Изглед „Архив“ – по месец */
    function renderArchive(ym){
      const list = POSTS.filter(p=> p.date.startsWith(ym));
      const d = new Date(ym + '-01T00:00:00');
      const label = d.toLocaleDateString('bg-BG', { month:'long', year:'numeric' });
      const app = document.getElementById('app');
      app.innerHTML = `<h2>Архив: ${label}</h2>`;
      renderHome(1, list);
    }

    /** Проста маршрутизация (hash) */
    function router(){
      const h = location.hash.replace(/^#/, '');
      document.getElementById('app').setAttribute('aria-busy','true');
      // #post/ID | #page/N | #tag/NAME | #archive/YYYY-MM | празно
      if(!h || h==='topics' || h==='archive' || h==='contact'){
        // за #topics/#archive/#contact – просто показваме home + потребителят може да навигира от ляво
        renderHome(1, POSTS);
      } else if(h.startsWith('post/')){
        const id = h.split('/')[1];
        renderPost(id);
      } else if(h.startsWith('page/')){
        const n = Math.max(1, parseInt(h.split('/')[1]||'1',10));
        renderHome(n, POSTS);
      } else if(h.startsWith('tag/')){
        const tag = decodeURIComponent(h.split('/').slice(1).join('/'));
        renderByTag(tag);
      } else if(h.startsWith('archive/')){
        const ym = h.split('/')[1];
        renderArchive(ym);
      } else {
        renderHome(1, POSTS);
      }
      document.getElementById('app').setAttribute('aria-busy','false');
    }

    /** Escape помощници */
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
    }
    function escapeQuotes(s){
      return String(s).replace(/["']/g, m=> ({'"':'&quot;','\'':'&#39;'}[m]));
    }

    // Инициализация
    const sorted = POSTS.slice().sort((a,b)=> b.date.localeCompare(a.date));
    renderSidebar(sorted);
    window.addEventListener('hashchange', router);
    router();

  </script>
</body>
</html>
